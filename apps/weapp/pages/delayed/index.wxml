<view class="container">
  <view class="header">
    <text class="title">{{i18n.title}}</text>
    <text class="subtitle">{{i18n.subtitle}}</text>
  </view>

  <view class="cards">
    <view class="card">
      <text class="card-title">{{i18n.stats}}</text>
      <view class="stats">
        <view class="stat"><text class="n">{{stats.totalTasks}}</text><text class="l">{{i18n.totalDelayedTasks}}</text></view>
        <view class="stat"><text class="n">{{stats.completedTasks}}</text><text class="l">{{i18n.completedToday}}</text></view>
        <view class="stat"><text class="n">{{stats.delayedTasks}}</text><text class="l">{{i18n.totalDelayed}}</text></view>
      </view>
    </view>
  </view>

  <view class="section">
    <text class="section-title">{{i18n.delayedTasks}}</text>
    <view wx:if="{{delayed.length===0}}" class="card empty-card"><t-empty description="{{i18n.noDelayedTasks || ''}}" /></view>
    <block wx:for="{{delayedView}}" wx:key="id">
      <view class="task-card {{item.id===selectedTaskId?'active':''}}" bindtap="onSelectTask" data-id="{{item.id}}">
        <view class="row space-between">
          <view>
            <text class="task-name">{{item.name}}</text>
            <text class="task-sub">{{item.delayCountShortText}}</text>
          </view>
          <t-tag wx:if="{{item.id===selectedTaskId}}" theme="warning" shape="round">{{i18n.delayingBadge}}</t-tag>
        </view>
      </view>
    </block>
  </view>

  <view class="section" wx:if="{{selectedTask}}">
    <text class="section-title">{{i18n.addExcuseButton}}</text>
    <t-textarea value="{{excuseInput}}" placeholder="{{i18n.placeholderAddExcuse || ''}}" autofocus bind:change="onTextareaChange" />
    <view class="row">
      <t-button size="small" variant="outline" shape="round" bind:tap="onAddExcuse">{{i18n.addExcuseButton}}</t-button>
      <t-button size="small" theme="primary" shape="round" loading="{{shareLoading}}" bind:tap="onShare">{{i18n.shareToSquareButton}}</t-button>
    </view>
  </view>

  <view class="section" wx:if="{{history.length>0}}">
    <text class="section-title">{{historyTitleText}} </text>
    <block wx:for="{{history}}" wx:key="id">
      <view class="excuse-item">
        <text class="content">{{item.content}}</text>
        <text class="time">{{item.timeAgo}}</text>
      </view>
    </block>
  </view>
</view>
