<view class="container">
  <view class="header">
    <view class="title">{{i18n.title}}</view>
    <view class="subtitle">{{i18n.perfectExcuse}}</view>
  </view>

  <!-- 统计面板（2x2） -->
  <view class="card stats-card">
    <text class="card-title">{{i18n.procrastinationStats}}</text>
    <view class="stats-grid">
      <view class="stat">
        <view class="icon">⏱</view>
        <text class="n">{{statsView.delayedTasks}}</text>
        <text class="l">{{i18n.totalDelayedTasks}}</text>
      </view>
      <view class="stat">
        <view class="icon">💬</view>
        <text class="n">{{statsView.totalExcuses}}</text>
        <text class="l">{{i18n.totalExcuses}}</text>
      </view>
      <view class="stat">
        <view class="icon">📈</view>
        <text class="n">{{statsView.averageExcuseText}}</text>
        <text class="l">{{i18n.averageExcuseLength}}</text>
      </view>
      <view class="stat">
        <view class="icon">🏅</view>
        <text class="n">{{statsView.longestStreakText}}</text>
        <text class="l">{{i18n.delayRanking}}</text>
      </view>
    </view>
  </view>

  <!-- 拖延中的任务列表 -->
  <view class="section">
    <view class="row space-between">
      <text class="section-title">{{i18n.delayedTasks}} ({{delayed.length}})</text>
    </view>
    <view class="hint">{{enjoyingDelayText}}</view>
    <view wx:if="{{delayed.length===0}}" class="card empty-card"><t-empty description="{{i18n.noDelayedTasks || ''}}" /></view>

    <block wx:for="{{delayedView}}" wx:key="id">
      <view class="task-card card">
        <view class="row space-between">
          <view>
            <text class="task-name">{{item.name}}</text>
            <view class="task-meta muted">📅 {{item.delayCountShortText}} · {{i18n.lastLabel.replace('{time}', item.lastTimeShort || '-')}}</view>
          </view>
          <t-tag theme="warning" shape="round">{{i18n.delayingBadge}}</t-tag>
        </view>

        <view class="textarea-wrap">
          <t-textarea value="{{excuseDrafts[item.id]}}" placeholder="{{i18n.placeholderAddExcuse || ''}}" maxcharacter="{{500}}" indicator bind:change="onDraftChange" data-id="{{item.id}}" />
        </view>

        <view class="actions two">
          <view class="action"><t-button size="small" shape="round" variant="base" theme="default" data-id="{{item.id}}" bind:tap="onAddExcuse" style="background:#9ca3af;color:#fff;height:72rpx;line-height:72rpx;padding:0 16rpx;" custom-style="background:#9ca3af;color:#fff;height:72rpx;line-height:72rpx;padding:0 16rpx;">💬 {{i18n.addExcuseButton}}</t-button></view>
          <view class="action"><t-button size="small" shape="round" theme="primary" data-id="{{item.id}}" bind:tap="onShare" style="height:72rpx;line-height:72rpx;padding:0 16rpx;" custom-style="height:72rpx;line-height:72rpx;padding:0 16rpx;">🔗 {{i18n.shareToSquareButton}}</t-button></view>
        </view>

        <t-button size="large" shape="round" data-id="{{item.id}}" bind:tap="onComplete" style="width:100%;background:#16a34a;color:#fff;height:72rpx;line-height:72rpx;padding:0 24rpx;" custom-style="width:100%;background:#16a34a;color:#fff;height:72rpx;line-height:72rpx;padding:0 24rpx;">{{i18n.completeButton}}</t-button>
      </view>
    </block>
  </view>
</view>
