<view class="container">
  <view class="header">
    <view class="title">{{i18n.title}}</view>
    <view class="subtitle">{{i18n.subtitle}}</view>
  </view>

  <view class="tabs">
    <view class="tab {{tab==='all'?'active':''}}" data-tab="all" bindtap="switchTab">全部</view>
    <view class="tab {{tab==='popular'?'active':''}}" data-tab="popular" bindtap="switchTab">{{i18n.popular}}</view>
    <view class="tab {{tab==='recent'?'active':''}}" data-tab="recent" bindtap="switchTab">{{i18n.recent}}</view>
  </view>

  <!-- 骨架屏：加载中且列表为空 -->
  <view wx:if="{{loading && list.length===0}}" class="card">
    <t-skeleton row-col="{{skeletonRowCol}}" loading />
  </view>

  <view wx:if="{{list.length===0 && !loading}}" class="card"><t-empty description="{{i18n.noShares || ''}}" /></view>

  <block wx:for="{{list}}" wx:key="id">
    <view class="card">
      <view class="row space-between">
        <view class="author">
          <t-avatar class="avatar" size="40" image="{{item.userAvatar||'https://api.dicebear.com/7.x/avataaars/svg?seed=default'}}"/>
          <view class="meta-line">
            <text class="name">{{item.userName||'用户'}}</text>
            <text class="dot">·</text>
            <text class="time">{{item.metaLine}}</text>
          </view>
        </view>
      </view>
      <view class="content">
        <text class="task">{{item.taskName}}</text>
        <text class="excuse">{{item.excuse}}</text>
      </view>
      <view class="actions">
        <t-button size="small" variant="text" class="action-btn heart {{item.isLiked?'liked':''}}" data-id="{{item.id}}" bind:tap="toggleLike">
          <text class="action-icon">❤</text>
          <text class="action-count">{{item.likesCount||0}}</text>
        </t-button>
        <t-button size="small" variant="text" class="action-btn star {{item.isFavorited?'favorited':''}}" data-id="{{item.id}}" bind:tap="toggleFavorite">
          <text class="action-icon">⭐</text>
        </t-button>
        <t-button size="small" variant="text" class="action-btn comment" data-id="{{item.id}}" bind:tap="toggleCommentBox">
          <text class="action-icon">💬</text>
        </t-button>
      </view>

      <view wx:if="{{activeCommentFor===item.id}}" class="comment-box">
        <t-input value="{{commentInput}}" placeholder="{{i18n.commentPlaceholder}}" clearable bind:change="onCommentInputChange" />
        <t-button size="small" theme="primary" shape="round" data-id="{{item.id}}" bind:tap="sendComment">{{i18n.send}}</t-button>
      </view>

      <view wx:if="{{item.commentsLoaded}}" class="comments">
        <block wx:for="{{item.comments}}" wx:key="id">
          <view class="comment">
            <t-avatar size="36" image="{{item.userAvatar||'https://api.dicebear.com/7.x/avataaars/svg?seed=default'}}"/>
            <view class="c-main">
              <text class="c-name">{{item.userName||'用户'}}</text>
              <text class="c-content">{{item.content}}</text>
              <text class="c-time">{{item.createdAtText}}</text>
            </view>
          </view>
        </block>
      </view>
    </view>
  </block>

  <view wx:if="{{loading}}" class="loading">Loading...</view>
</view>
