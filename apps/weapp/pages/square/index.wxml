<view class="container">
  <view class="header">
    <view class="title">{{i18n.title}}</view>
    <view class="subtitle">{{i18n.subtitle}}</view>
  </view>

  <t-tabs value="{{tab}}" bind:change="onTabsChange">
    <t-tab-panel value="recent" label="{{i18n.recent || ''}}"></t-tab-panel>
    <t-tab-panel value="popular" label="{{i18n.popular || ''}}"></t-tab-panel>
  </t-tabs>

  <!-- 骨架屏：加载中且列表为空 -->
  <view wx:if="{{loading && list.length===0}}" class="card">
    <t-skeleton row-col="{{skeletonRowCol}}" loading />
  </view>

  <view wx:if="{{list.length===0 && !loading}}" class="card"><t-empty description="{{i18n.noShares || ''}}" /></view>

  <block wx:for="{{list}}" wx:key="id">
    <view class="card">
      <view class="row space-between">
        <view class="author">
          <t-avatar class="avatar" size="40" image="{{item.userAvatar||'https://api.dicebear.com/7.x/avataaars/svg?seed=default'}}"/>
          <view class="meta">
            <text class="name">{{item.userName||'用户'}}</text>
            <text class="time">{{item.metaLine}}</text>
          </view>
        </view>
      </view>
      <view class="content">
        <text class="task">{{item.taskName}}</text>
        <text class="excuse">{{item.excuse}}</text>
      </view>
      <view class="actions">
        <t-button size="small" variant="text" class="link {{item.isLiked?'active':''}}" data-id="{{item.id}}" bind:tap="toggleLike">👍 {{item.likesCount||0}}</t-button>
        <t-button size="small" variant="text" class="link {{item.isFavorited?'active':''}}" data-id="{{item.id}}" bind:tap="toggleFavorite">⭐</t-button>
        <t-button size="small" variant="text" class="link" data-id="{{item.id}}" bind:tap="toggleCommentBox">💬</t-button>
      </view>

      <view wx:if="{{activeCommentFor===item.id}}" class="comment-box">
        <t-input value="{{commentInput}}" placeholder="{{i18n.commentPlaceholder}}" clearable bind:change="onCommentInputChange" />
        <t-button size="small" theme="primary" shape="round" data-id="{{item.id}}" bind:tap="sendComment">{{i18n.send}}</t-button>
      </view>

      <view wx:if="{{item.commentsLoaded}}" class="comments">
        <block wx:for="{{item.comments}}" wx:key="id">
          <view class="comment">
            <t-avatar size="36" image="{{item.userAvatar||'https://api.dicebear.com/7.x/avataaars/svg?seed=default'}}"/>
            <view class="c-main">
              <text class="c-name">{{item.userName||'用户'}}</text>
              <text class="c-content">{{item.content}}</text>
              <text class="c-time">{{item.createdAtText}}</text>
            </view>
          </view>
        </block>
      </view>
    </view>
  </block>

  <view wx:if="{{loading}}" class="loading">Loading...</view>
</view>
